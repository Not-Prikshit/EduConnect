<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Sign-In - EduConnect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] }
                }
            }
        }
    </script>
</head>

<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-800 text-white">
    <div class="text-center p-8">
        <div class="mb-6">
            <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-indigo-500"></div>
        </div>
        <h2 class="text-2xl font-bold mb-2">Completing Sign-In...</h2>
        <p class="text-slate-400">Please wait while we redirect you.</p>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const userJson = urlParams.get('user');
        const redirectUrl = urlParams.get('redirect');
        const error = urlParams.get('error');

        if (error) {
            // Handle error
            alert('Login failed: ' + error);
            window.location.href = '/';
        } else if (userJson && redirectUrl) {
            try {
                // Decode and parse user data
                const userData = JSON.parse(decodeURIComponent(userJson));

                // Store in localStorage
                localStorage.setItem('edu_current_user', JSON.stringify(userData));

                // Redirect to dashboard
                setTimeout(() => {
                    window.location.href = redirectUrl;
                }, 500);
            } catch (e) {
                console.error('Error processing login:', e);
                alert('Error processing login. Please try again.');
                window.location.href = '/';
            }
        } else {
            // Missing parameters
            alert('Invalid callback. Please try logging in again.');
            window.location.href = '/';
        }
    </script>
</body>

</html>