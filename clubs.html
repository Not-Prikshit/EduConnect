<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduConnect - Clubs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    colors: { primary: '#6366f1', dark: '#0f172a' }
                }
            }
        }
    </script>
</head>

<body
    class="bg-slate-50 dark:bg-slate-900 min-h-screen font-sans text-slate-800 dark:text-white transition-colors duration-300">

    <div class="container mx-auto p-8">
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1
                    class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-500">
                    School Clubs</h1>
                <p class="text-slate-500 dark:text-slate-400 mt-1">Join a community, learn new skills.</p>
            </div>
            <button onclick="history.back()"
                class="px-4 py-2 rounded-lg bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 transition-all">Back
                to Dashboard</button>
        </div>

        <div id="clubs-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Clubs rendered here -->
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        // Clubs Logic
        const currentUser = JSON.parse(localStorage.getItem('edu_current_user'));
        if (!currentUser) window.location.href = 'index.html';

        const clubs = JSON.parse(localStorage.getItem('edu_clubs') || '[]');

        function renderClubs() {
            const grid = document.getElementById('clubs-grid');
            grid.innerHTML = clubs.map(club => {
                const isMember = club.members.includes(currentUser.id);
                return `
                    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all border border-slate-100 dark:border-slate-700">
                        <div class="h-32 bg-gradient-to-r from-indigo-500 to-purple-600 flex items-center justify-center">
                            <span class="text-4xl">ðŸŽ©</span>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">${club.name}</h3>
                            <p class="text-slate-500 dark:text-slate-400 text-sm mb-4 line-clamp-2">${club.description}</p>
                            
                            <div class="flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-4">
                                <span>ðŸ‘‘ President: ${club.president}</span>
                            </div>

                            <div class="flex items-center justify-between mt-4">
                                <span class="text-xs font-medium px-2 py-1 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300">${club.members.length} Members</span>
                                ${currentUser.role === 'student' ? `
                                    <button onclick="toggleMembership('${club.id}')" class="px-4 py-2 rounded-lg text-sm font-medium transition-all ${isMember ? 'bg-rose-100 text-rose-600 hover:bg-rose-200' : 'bg-indigo-600 text-white hover:bg-indigo-700'}">
                                        ${isMember ? 'Leave Club' : 'Join Club'}
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleMembership(clubId) {
            const clubIndex = clubs.findIndex(c => c.id === clubId);
            if (clubIndex === -1) return;

            const club = clubs[clubIndex];
            const memberIndex = club.members.indexOf(currentUser.id);

            if (memberIndex > -1) {
                club.members.splice(memberIndex, 1);
                // Also update user's club list
                const userClubsIndex = currentUser.clubs.indexOf(club.name);
                if (userClubsIndex > -1) currentUser.clubs.splice(userClubsIndex, 1);
            } else {
                club.members.push(currentUser.id);
                currentUser.clubs.push(club.name);
            }

            // Save everything
            clubs[clubIndex] = club;
            localStorage.setItem('edu_clubs', JSON.stringify(clubs));

            // Update current user in local storage and session
            localStorage.setItem('edu_current_user', JSON.stringify(currentUser));

            // Update the main students list as well
            const students = JSON.parse(localStorage.getItem('edu_students'));
            const studentIndex = students.findIndex(s => s.id === currentUser.id);
            if (studentIndex > -1) {
                students[studentIndex] = currentUser;
                localStorage.setItem('edu_students', JSON.stringify(students));
            }

            renderClubs();
        }

        renderClubs();
    </script>
</body>

</html>